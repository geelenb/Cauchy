<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>math.js | plot</title>
    <script src="math.min.js"></script>

    <script src="plotly.js"></script>

    <style>
        input[type=text] {
            width: 300px;
        }
        input {
            padding: 6px;
        }
        body, html, input {
            font-family: sans-serif;
            font-size: 11pt;

        }
        form {
            margin: 20px 0;
        }
    </style>
</head>
<body>

<form id="form">
    <label for="eq">Enter an equation:</label>
    <input type="text" id="eq" value="4 * sin(x) + 5 * cos(x/2)" />
    <input type="submit" value="Draw" />
</form>

<div id="plot"></div>

<div id="coors"></div>

<script>
    function event_coor(event) {
        let elem = event.target;
        while (elem && !elem._fullLayout) {
            elem = elem.parentElement;
        }
        const fl = elem._fullLayout;

        return {
            x: fl.xaxis.p2c(event.x - fl.margin.l),
            y: fl.yaxis.p2c(event.y - fl.margin.t),
        }
    }

    function draw() {
        // compile the expression once
        // const expression = document.getElementById('eq').value;
        // const expr = math.compile(expression);

        // evaluate the expression repeatedly for different values of x
        const xValues = math.range(-10, 10, 0.5).toArray();
        // const yValues = xValues.map(function (x) {
        //     return expr.evaluate({x: x})
        // });
        // const yValues = xValues;

        // render the plot using plotly
        Plotly.newPlot('plot', [{
            x: xValues,
            y: xValues,
            type: 'scatter',
        }]);

        document.querySelector('#plot').addEventListener('mousemove', (event) => {
            const coor = event_coor(event);
            let x = coor.x, y = coor.y;
            // console.log(coor);
            document.getElementById('coors').innerHTML = `${x} <br> ${y} <br>`
            // debugger;
        })
    }

    document.getElementById('form').onsubmit = function (event) {
        event.preventDefault();
        draw()
    };

    draw()
</script>

</body>
</html>

